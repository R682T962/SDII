Version 4
SHEET 1 3736 680
WIRE 48 -576 16 -576
WIRE 112 -576 48 -576
WIRE 288 -576 112 -576
WIRE 576 -576 480 -576
WIRE 784 -576 576 -576
WIRE 816 -576 784 -576
WIRE 112 -528 112 -576
WIRE 576 -512 576 -576
WIRE 288 -480 224 -480
WIRE 112 -400 112 -464
WIRE 224 -400 224 -480
WIRE 224 -400 112 -400
WIRE 576 -400 576 -432
WIRE 576 -400 480 -400
WIRE 816 -400 576 -400
WIRE 480 -368 480 -400
WIRE 576 -368 576 -400
WIRE 112 -304 112 -400
WIRE 480 -272 480 -304
WIRE 576 -272 576 -288
WIRE 576 -272 480 -272
WIRE -784 -256 -784 -336
WIRE -560 -256 -784 -256
WIRE 576 -240 576 -272
WIRE 3376 -240 3376 -256
WIRE -784 -224 -784 -256
WIRE -480 -176 -624 -176
WIRE 2512 -176 2496 -176
WIRE -560 -144 -560 -256
WIRE 1808 -144 1568 -144
WIRE -624 -128 -624 -176
WIRE -592 -128 -624 -128
WIRE 3376 -128 3376 -160
WIRE -480 -112 -480 -176
WIRE -480 -112 -528 -112
WIRE -400 -112 -480 -112
WIRE -64 -112 -128 -112
WIRE 48 -112 0 -112
WIRE 144 -112 48 -112
WIRE 256 -112 144 -112
WIRE -976 -96 -1104 -96
WIRE -784 -96 -784 -160
WIRE -784 -96 -896 -96
WIRE -736 -96 -784 -96
WIRE -592 -96 -656 -96
WIRE 1712 -96 1648 -96
WIRE 2496 -96 2496 -176
WIRE 48 -80 48 -112
WIRE 2224 -80 2224 -96
WIRE 2464 -80 2224 -80
WIRE 144 -64 144 -112
WIRE 1648 -64 1648 -96
WIRE 2688 -64 2528 -64
WIRE 2800 -64 2688 -64
WIRE -784 -48 -784 -96
WIRE 1568 -48 1568 -144
WIRE 1616 -48 1568 -48
WIRE 2272 -48 2224 -48
WIRE 2384 -48 2352 -48
WIRE 2464 -48 2384 -48
WIRE 3200 -48 3120 -48
WIRE 3312 -48 3280 -48
WIRE 3328 -48 3312 -48
WIRE 1808 -32 1808 -144
WIRE 1808 -32 1680 -32
WIRE 1856 -32 1808 -32
WIRE 1104 -16 1072 -16
WIRE 1216 -16 1184 -16
WIRE 1248 -16 1216 -16
WIRE 1376 -16 1328 -16
WIRE 1408 -16 1376 -16
WIRE 1552 -16 1488 -16
WIRE 1616 -16 1552 -16
WIRE 3312 -16 3312 -48
WIRE 1216 0 1216 -16
WIRE 48 32 48 0
WIRE 144 32 144 0
WIRE 144 32 48 32
WIRE 304 32 144 32
WIRE 608 32 304 32
WIRE 640 32 640 -16
WIRE 640 32 608 32
WIRE 672 32 640 32
WIRE 1552 32 1552 -16
WIRE 672 48 672 32
WIRE 1648 80 1648 0
WIRE 3312 80 3312 64
WIRE 3376 80 3376 -32
WIRE 3376 80 3312 80
WIRE 336 96 272 96
WIRE 608 96 608 32
WIRE 608 96 560 96
WIRE 1216 96 1216 64
WIRE 2384 112 2384 -48
WIRE 2480 112 2384 112
WIRE 2688 112 2688 -64
WIRE 2688 112 2560 112
WIRE 3376 128 3376 80
WIRE 256 160 256 -112
WIRE 336 160 256 160
WIRE 592 160 560 160
WIRE 672 160 672 128
WIRE 672 160 592 160
WIRE 1552 160 1552 96
WIRE 672 192 672 160
WIRE 336 224 176 224
WIRE 592 224 592 160
WIRE 592 224 560 224
WIRE 1376 224 1376 -16
WIRE 1552 224 1376 224
WIRE 1808 224 1808 -32
WIRE 1808 224 1616 224
WIRE 304 288 304 32
WIRE 336 288 304 288
WIRE 576 288 560 288
WIRE 672 288 672 256
WIRE 672 288 640 288
WIRE 272 416 272 96
WIRE 448 416 272 416
WIRE 672 416 672 288
WIRE 672 416 448 416
WIRE 448 448 448 416
WIRE -208 464 -352 464
FLAG -352 544 0
FLAG 640 -16 Vcc
FLAG -352 464 Vtrig
FLAG 448 448 0
FLAG 176 224 PWM
FLAG 1072 -16 PWM
FLAG 1552 160 0
FLAG 1216 96 0
FLAG 1856 -32 avg
FLAG 2224 -48 avg
FLAG 2224 -96 Vref
FLAG 2800 -64 comparator
FLAG 3120 -48 comparator
FLAG 2496 -32 0
FLAG 3376 128 0
FLAG 1648 80 0
FLAG -784 16 0
FLAG -560 -80 0
FLAG -1104 -96 Vtrig
FLAG -64 -576 0
FLAG 112 -304 0
FLAG 576 -240 0
FLAG 816 -400 Vref
FLAG 816 -576 Vcc
FLAG -400 -112 buffer
FLAG -128 -112 buffer
FLAG 3376 -256 Output
FLAG -208 544 Vcc
FLAG 48 -576 V1
FLAG -784 -336 V1
FLAG -496 -256 0
FLAG 48 -512 0
FLAG 784 -512 0
FLAG 704 -16 0
FLAG 1776 -96 0
FLAG 1648 -96 Vcc
FLAG 2576 -176 0
FLAG 2496 -176 Vcc
SYMBOL voltage -352 448 R0
WINDOW 3 -127 -79 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 0 0.01m 0.01m 11.25m 22.5m)
SYMATTR InstName V3
SYMBOL Misc\\NE555 448 192 R0
SYMATTR InstName U2
SYMBOL cap 640 272 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 10n
SYMBOL cap 656 192 R0
SYMATTR InstName C2
SYMATTR Value 1µ
SYMBOL res 656 32 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 32 -96 R0
SYMATTR InstName R3
SYMATTR Value 5k
SYMBOL cap 0 -128 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 10n
SYMBOL diode 128 -64 R0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 1344 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL res 1504 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL cap 1568 96 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL OpAmps\\LT1638 1648 -96 R0
SYMATTR InstName U3
SYMBOL cap 1616 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10µ
SYMBOL res 1200 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL cap 1200 0 R0
SYMATTR InstName C4
SYMATTR Value 10n
SYMBOL OpAmps\\LT1638 2496 -128 R0
WINDOW 3 32 133 Left 2
SYMATTR InstName U4
SYMBOL res 2368 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 2576 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 20k
SYMBOL nmos 3328 -128 R0
SYMATTR InstName M1
SYMATTR Value Si7336ADP
SYMBOL res 3296 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 220
SYMBOL res 3328 80 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL res -880 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 33k
SYMBOL diode -768 16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode -768 -160 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL OpAmps\\LT1638 -560 -176 R0
SYMATTR InstName U1
SYMBOL res -640 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL voltage 32 -576 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 28
SYMBOL TVSdiode 96 -528 R0
SYMATTR InstName D4
SYMATTR Value MyTVS
SYMBOL References\\LT1021-5 384 -528 R0
SYMATTR InstName U5
SYMBOL res 560 -528 R0
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL res 560 -384 R0
SYMATTR InstName R13
SYMATTR Value 98k
SYMBOL cap 464 -368 R0
SYMATTR InstName C7
SYMATTR Value 1µ
SYMBOL res 3360 -256 R0
SYMATTR InstName R14
SYMATTR Value 5
SYMBOL res -224 448 R0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL cap -496 -272 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 100n
SYMBOL cap 704 -32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL cap 800 -512 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C10
SYMATTR Value 100n
SYMBOL cap 64 -512 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C11
SYMATTR Value 1µ
SYMBOL cap 1712 -80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C12
SYMATTR Value 100n
SYMBOL cap 2512 -160 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C13
SYMATTR Value 100n
TEXT -488 288 Left 2 !.tran 0 2 1
TEXT -496 -744 Left 2 !.model MyTVS d Ron=10m Vfwd=90 Vrev=90 Epsilon=1 RevEpsilon=1
